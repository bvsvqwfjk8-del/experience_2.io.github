<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>洛春赋 - 音乐播放器</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* 自定义动画 */
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 10s linear infinite;
        }
        /* 隐藏滚动条但保留功能 */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        /* 播放动画条 */
        .playing-bar {
            animation: sound-wave 0.8s ease-in-out infinite alternate;
        }
        @keyframes sound-wave {
            0% { height: 20%; }
            100% { height: 100%; }
        }
    </style>
</head>
<body class="bg-black text-white font-sans overflow-hidden selection:bg-green-500 selection:text-white">

    <div class="min-h-screen bg-gradient-to-br from-[#0f1510] via-[#1a2e22] to-[#0a0f0b] flex flex-col relative">
        
        <!-- 隐藏的 Audio 标签 -->
        <audio id="audio-player" preload="metadata"></audio>

        <!-- 背景氛围 -->
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-green-900/20 blur-[120px] rounded-full pointer-events-none"></div>

        <!-- 主内容区域 -->
        <div class="flex-1 flex items-center justify-center w-full max-w-6xl mx-auto px-8 relative z-10">
            <div class="flex flex-col md:flex-row items-center gap-12 md:gap-24 w-full justify-center transition-all duration-500">
                
                <!-- 黑胶唱片区域 -->
                <div class="relative group">
                    <div id="record-disc" class="w-64 h-64 md:w-[420px] md:h-[420px] rounded-full bg-black shadow-2xl flex items-center justify-center border-[8px] border-[#111] relative transition-transform" style="box-shadow: 0 20px 50px rgba(0,0,0,0.6);">
                        <!-- 唱片纹理 -->
                        <div class="absolute inset-0 rounded-full border border-white/5 opacity-50 scale-95 pointer-events-none"></div>
                        <div class="absolute inset-0 rounded-full border border-white/5 opacity-40 scale-90 pointer-events-none"></div>
                        <div class="absolute inset-0 rounded-full border border-white/5 opacity-30 scale-75 pointer-events-none"></div>
                        
                        <!-- 封面图 -->
                        <div class="w-40 h-40 md:w-64 md:h-64 rounded-full overflow-hidden border-4 border-[#1a1a1a] relative z-10">
                            <!-- 注意：这里的 src 会被 JS 覆盖，所以这里留空或者写默认图都可以，重要的是下面的 script 数据 -->
                            <img id="cover-image" src="" alt="Album Art" class="w-full h-full object-cover transition-opacity duration-500">
                        </div>
                    </div>
                </div>

                <!-- 歌曲信息 -->
                <div class="text-center md:text-left z-20">
                    <h1 id="track-title" class="text-5xl md:text-7xl font-light tracking-wide mb-4 text-gray-100 transition-opacity duration-300">
                        洛春赋
                    </h1>
                    <!-- 修改区域：将作者替换为学号和姓名 -->
                    <div class="flex items-center justify-center md:justify-start gap-3 text-gray-400 text-lg md:text-xl font-light">
                        <span class="text-gray-300">学号：25216950320 姓名：黄颖锋</span>
                    </div>
                </div>

            </div>
        </div>

        <!-- 底部控制栏 -->
        <div class="w-full bg-gradient-to-t from-black/90 to-transparent pb-6 pt-12 px-6 md:px-12 relative z-30">
            
            <!-- 进度条 -->
            <div id="progress-container" class="group w-full h-1 bg-white/10 rounded-full cursor-pointer mb-4 relative hover:h-1.5 transition-all">
                <div id="progress-bar" class="h-full bg-[#4ade80] rounded-full relative pointer-events-none w-0">
                    <div class="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-lg"></div>
                </div>
            </div>

            <!-- 控制按钮行 -->
            <div class="flex items-center justify-between select-none">
                
                <!-- 左侧时间 -->
                <div class="text-sm font-mono text-gray-400 w-32">
                    <span id="current-time">00:00</span> <span class="mx-1 text-gray-600">/</span> <span id="duration-time">00:00</span>
                </div>

                <!-- 中间播放控制 -->
                <div class="flex items-center gap-6 md:gap-8">
                    <button class="text-gray-400 hover:text-white transition-colors">
                        <i data-lucide="repeat" width="20"></i>
                    </button>
                    <button id="btn-prev" class="text-gray-300 hover:text-white transition-colors active:scale-95 transform">
                        <i data-lucide="skip-back" width="28" stroke-width="1.5"></i>
                    </button>
                    
                    <!-- 播放/暂停按钮 -->
                    <button id="btn-play" class="w-16 h-16 flex items-center justify-center rounded-full hover:scale-105 active:scale-95 transition-all shadow-[0_0_20px_rgba(74,222,128,0.3)] hover:shadow-[0_0_30px_rgba(74,222,128,0.5)] bg-transparent overflow-hidden">
                        <!-- 1. 播放状态图标 -->
                        <img id="icon-play" src="./img/播放.jpg" alt="Play" class="w-full h-full object-cover">
                        <!-- 2. 暂停状态图标 -->
                        <img id="icon-pause" src="./img/0dc56fa1e2271883 (1).jpg" alt="Pause" class="w-full h-full object-cover hidden">
                    </button>

                    <button id="btn-next" class="text-gray-300 hover:text-white transition-colors active:scale-95 transform">
                        <i data-lucide="skip-forward" width="28" stroke-width="1.5"></i>
                    </button>
                    
                    <!-- 音量控制 -->
                    <div class="flex items-center gap-2 group">
                        <button id="btn-volume" class="text-gray-400 hover:text-white">
                            <i data-lucide="volume-2" width="20"></i>
                        </button>
                        <div id="volume-container" class="w-20 h-1 bg-white/10 rounded-full cursor-pointer overflow-hidden relative">
                            <div id="volume-bar" class="h-full bg-white/50 hover:bg-[#4ade80] transition-all absolute left-0 top-0 w-[80%]"></div>
                        </div>
                    </div>
                </div>

                <!-- 右侧工具栏 -->
                <div class="flex items-center gap-5 text-gray-400 w-32 justify-end">
                    <button class="hover:text-white transition-colors" title="画中画">
                        <i data-lucide="monitor-play" width="20" stroke-width="1.5"></i>
                    </button>
                    
                    <!-- 倍速按钮 -->
                    <button id="btn-speed" class="hover:text-white transition-colors text-sm font-medium tracking-wide w-12 text-center select-none" title="点击切换倍速">
                        1.0X
                    </button>
                    
                    <button id="btn-playlist" class="hover:text-white transition-colors" title="播放列表">
                        <i data-lucide="list-music" width="20" stroke-width="1.5"></i>
                    </button>
                </div>

            </div>
        </div>

        <!-- 侧边播放列表面板 -->
        <div id="playlist-drawer" class="fixed inset-y-0 right-0 w-80 bg-black/40 backdrop-blur-xl border-l border-white/10 z-50 transform translate-x-full transition-transform duration-300 ease-in-out">
            <div class="p-6 h-full flex flex-col">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-light text-white flex items-center gap-2">
                        <i data-lucide="list-music" width="20"></i> 播放列表
                    </h2>
                    <button id="btn-close-playlist" class="text-gray-400 hover:text-white transition-colors">
                        <i data-lucide="x" width="20"></i>
                    </button>
                </div>

                <div id="playlist-container" class="flex-1 overflow-y-auto pr-2 space-y-2 custom-scrollbar">
                    <!-- 列表项将由 JS 动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // 2. 初始化图标
        // ============================================
        lucide.createIcons();

        // ============================================
        // 3. DOM 元素获取
        // ============================================
        const audio = document.getElementById('audio-player');
        const recordDisc = document.getElementById('record-disc');
        const coverImage = document.getElementById('cover-image');
        const trackTitle = document.getElementById('track-title');
        // const trackArtist = document.getElementById('track-artist'); // 已移除
        
        const btnPlay = document.getElementById('btn-play');
        const iconPlay = document.getElementById('icon-play'); 
        const iconPause = document.getElementById('icon-pause');
        
        const btnPrev = document.getElementById('btn-prev');
        const btnNext = document.getElementById('btn-next');
        
        const currentTimeEl = document.getElementById('current-time');
        const durationTimeEl = document.getElementById('duration-time');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        
        const btnVolume = document.getElementById('btn-volume');
        const volumeContainer = document.getElementById('volume-container');
        const volumeBar = document.getElementById('volume-bar');
        
        const btnSpeed = document.getElementById('btn-speed');

        const btnPlaylist = document.getElementById('btn-playlist');
        const btnClosePlaylist = document.getElementById('btn-close-playlist');
        const playlistDrawer = document.getElementById('playlist-drawer');
        const playlistContainer = document.getElementById('playlist-container');


        // ============================================
        // 1. 数据定义
        // ============================================
        const PLAYLIST = [
            {
                id: 1,
                title: "洛春赋",
                artist: "云汐",
                cover: "https://images.unsplash.com/photo-1518621736915-f3b1c41bfd00?q=80&w=600&auto=format&fit=crop", 
                url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
                duration: "06:12"
            },
            {
                id: 2,
                title: "星河入梦",
                artist: "云汐",
                cover: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=600&auto=format&fit=crop",
                url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
                duration: "07:05"
            },
            {
                id: 3,
                title: "月下独酌",
                artist: "云汐",
                cover: "https://images.unsplash.com/photo-1518621736915-f3b1c41bfd00?q=80&w=600&auto=format&fit=crop",
                url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3",
                duration: "05:44"
            },
            {
                id: 4,
                title: "深林幽谷",
                artist: "佚名",
                cover: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=600&auto=format&fit=crop",
                url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3",
                duration: "03:30"
            }
        ];

        let currentIndex = 0;
        let isPlaying = false;
        let currentVolume = 0.8;
        
        const speeds = [1.0, 1.25, 1.5, 2.0, 0.5];
        let speedIndex = 0;

        // 4. 核心逻辑函数
        
        function loadTrack(index) {
            const track = PLAYLIST[index];
            audio.src = track.url;
            
            if(coverImage) {
                coverImage.src = track.cover;
                coverImage.onerror = function() {
                    console.log("图片加载失败，可能是路径不对:", track.cover);
                };
            }
            
            trackTitle.textContent = track.title;
            // 移除了动态更新作者的逻辑，使其保持为固定的学号姓名
            // trackArtist.textContent = track.artist; 
            
            currentTimeEl.textContent = "00:00";
            progressBar.style.width = "0%";
            
            // 切歌时：重置唱片动画
            recordDisc.classList.remove('animate-spin-slow');
            recordDisc.style.animationPlayState = 'paused';

            // 切歌时保持当前的播放速度
            audio.playbackRate = speeds[speedIndex];

            updatePlaylistUI();
            lucide.createIcons();
        }

        function playTrack() {
            audio.play().then(() => {
                isPlaying = true;
                updatePlayButton();
                recordDisc.classList.add('animate-spin-slow');
                recordDisc.style.animationPlayState = 'running';
                
                updatePlaylistUI();
            }).catch(e => console.error("Playback error:", e));
        }

        function pauseTrack() {
            audio.pause();
            isPlaying = false;
            updatePlayButton();
            recordDisc.style.animationPlayState = 'paused';
            
            updatePlaylistUI();
        }

        function updatePlayButton() {
            if (isPlaying) {
                iconPlay.classList.add('hidden');
                iconPause.classList.remove('hidden');
            } else {
                iconPlay.classList.remove('hidden');
                iconPause.classList.add('hidden');
            }
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return "00:00";
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function renderPlaylist() {
            playlistContainer.innerHTML = '';
            PLAYLIST.forEach((track, index) => {
                const isActive = index === currentIndex;
                const activeClass = isActive ? 'bg-white/10 border-[#4ade80]/30' : 'border-transparent hover:bg-white/5';
                const textClass = isActive ? 'text-[#4ade80]' : 'text-gray-200';
                
                const waveAnim = isActive && isPlaying ? `
                    <div class="absolute inset-0 bg-black/50 flex items-center justify-center">
                        <div class="w-1 h-3 bg-[#4ade80] playing-bar mx-[1px]" style="animation-delay:0s"></div>
                        <div class="w-1 h-4 bg-[#4ade80] playing-bar mx-[1px]" style="animation-delay:0.1s"></div>
                        <div class="w-1 h-2 bg-[#4ade80] playing-bar mx-[1px]" style="animation-delay:0.2s"></div>
                    </div>
                ` : '';

                const item = document.createElement('div');
                item.className = `p-3 rounded-lg flex items-center gap-3 cursor-pointer transition-all border ${activeClass}`;
                item.innerHTML = `
                    <div class="relative w-10 h-10 rounded overflow-hidden flex-shrink-0">
                        <img src="${track.cover}" class="w-full h-full object-cover">
                        ${waveAnim}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="text-sm font-medium truncate ${textClass}">${track.title}</div>
                        <div class="text-xs text-gray-500 truncate">${track.artist}</div>
                    </div>
                    <div class="text-xs text-gray-600 font-mono">${track.duration}</div>
                `;
                
                item.onclick = () => {
                    if (index === currentIndex) {
                        isPlaying ? pauseTrack() : playTrack();
                    } else {
                        currentIndex = index;
                        loadTrack(currentIndex);
                        playTrack();
                    }
                };
                
                playlistContainer.appendChild(item);
            });
        }

        function updatePlaylistUI() {
            renderPlaylist(); 
        }

        // 5. 事件监听

        btnPlay.addEventListener('click', () => {
            if (isPlaying) pauseTrack();
            else playTrack();
        });

        btnPrev.addEventListener('click', () => {
            currentIndex = (currentIndex - 1 + PLAYLIST.length) % PLAYLIST.length;
            loadTrack(currentIndex);
            if (isPlaying) playTrack();
        });

        btnNext.addEventListener('click', () => {
            currentIndex = (currentIndex + 1) % PLAYLIST.length;
            loadTrack(currentIndex);
            if (isPlaying) playTrack();
        });

        audio.addEventListener('timeupdate', () => {
            const current = audio.currentTime;
            const duration = audio.duration;
            const percent = (current / duration) * 100;
            
            currentTimeEl.textContent = formatTime(current);
            progressBar.style.width = `${percent}%`;
        });

        audio.addEventListener('loadedmetadata', () => {
            durationTimeEl.textContent = formatTime(audio.duration);
        });

        audio.addEventListener('ended', () => {
            btnNext.click();
        });

        progressContainer.addEventListener('click', (e) => {
            const rect = progressContainer.getBoundingClientRect();
            const width = rect.width;
            const clickX = e.clientX - rect.left;
            const duration = audio.duration;
            
            audio.currentTime = (clickX / width) * duration;
        });

        volumeContainer.addEventListener('click', (e) => {
            const rect = volumeContainer.getBoundingClientRect();
            const width = rect.width;
            const clickX = e.clientX - rect.left;
            let volume = clickX / width;
            if (volume < 0) volume = 0;
            if (volume > 1) volume = 1;
            
            audio.volume = volume;
            currentVolume = volume;
            volumeBar.style.width = `${volume * 100}%`;
        });
        
        btnVolume.addEventListener('click', () => {
            if (audio.volume > 0) {
                audio.volume = 0;
                volumeBar.style.width = '0%';
            } else {
                audio.volume = currentVolume;
                volumeBar.style.width = `${currentVolume * 100}%`;
            }
        });

        // 倍速切换监听
        btnSpeed.addEventListener('click', () => {
            speedIndex = (speedIndex + 1) % speeds.length;
            const newSpeed = speeds[speedIndex];
            
            audio.playbackRate = newSpeed;
            btnSpeed.textContent = newSpeed + "X";
        });

        btnPlaylist.addEventListener('click', () => {
            playlistDrawer.classList.remove('translate-x-full');
            btnPlaylist.classList.add('text-[#4ade80]');
        });

        btnClosePlaylist.addEventListener('click', () => {
            playlistDrawer.classList.add('translate-x-full');
            btnPlaylist.classList.remove('text-[#4ade80]');
        });

        // 6. 启动
        window.addEventListener('DOMContentLoaded', () => {
            loadTrack(currentIndex);
        });

    </script>
</body>
</html>